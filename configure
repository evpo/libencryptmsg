#!/bin/bash

set -e
set -o pipefail

USAGE="USAGE: configure [options]\n\
--help               this help information

build options:\n\
--debug-mode         enable debug info and disable optimizations\n\

installation options:\n\
--prefix=DIR         set the install prefix\n\
--libdir=DIR         set the library install dir\n
--includedir=DIR     set the include file install dir\n"

VERSION=0.0.1
DEBUG_MODE=false
PREFIX=/usr/local
LIBDIR=lib
INCLUDEDIR=include

while [[ $# > 0 ]]
do
    case $1 in
        --debug-mode)
            DEBUG_MODE=true
            ;;
        --prefix=*)
            PREFIX=${1#--prefix=}
            ;;
        --libdir=*)
            LIBDIR=${1#--libdir=}
            ;;
        --includedir=*)
            INCLUDEDIR=${1#--includedir=}
            ;;
        --help)
            echo -e "$USAGE"
            exit 0
            ;;
        *)
            ;;
    esac
    shift
done

echo -n "pkg-config version: "
if ! pkg-config --version ; then
    echo "pkg-config is not found"
    exit -1
fi

if ! pkg-config --exists botan-2; then
    echo "pkg-config: package botan-2 is not found"
    exit -1
fi

mkdir -p build
cat > build/config.mak << EOM
PREFIX=$PREFIX
LIBDIR=$LIBDIR
INCLUDEDIR=$INCLUDEDIR
DEBUG_MODE=$DEBUG_MODE
VERSION=$VERSION
EOM

cat > build/libencryptmsg.pc << EOM
prefix=$PREFIX
libdir=$PREFIX/$LIBDIR
includedir=$PREFIX/$INCLUDEDIR/libencryptmsg

Name: libencryptmsg
Description: Symmetric encryption OpenPGP library
Version: $VERSION

Libs: -L\${libdir} -lencryptmsg
Cflags: -I\${includedir}
EOM
